---
title: 'Task 2: Palmetto'
author: "Bri Baker"
date: "2/1/2021"
output: 
  html_document:
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      message = FALSE, 
                      warning = FALSE)
library(tidyverse)
library(here)
library(janitor)
library(GGally)
library(broom)
```

## Introduction

use binary logistic regression to test feasibility of using variables plant height (height), canopy length (length), canopy width (width), and number of green leaves (green_lvs) to classify whether a palmetto is species *Serenoa repens* or *Sabal etonia*.

remember to make a note about the years


```{r data}

#could use col_types() if were using treatment

palmetto <- read_csv(here("task_2/palmetto.csv")) %>% # import data
  mutate(species_name = if_else(species == 1, "Serenoa repens", "Sabal etonia"), # add species names
         species_name = factor(species_name)) %>% # make names into factor for blm
  select(species, species_name, height:green_lvs) # select relevant columns

```


## Species Comparison

```{r ggpairs}

ggpairs(palmetto, aes(color = species_name)) # make ggpairs plot to generally visualize

```

```{r green leaves, fig.cap= "words here"}

# length vs leaves scatterplot

ggplot(data = palmetto, aes(x = length, y = green_lvs)) +
  geom_point(aes(color = species_name))

```


```{r height}
# boxplot of height by species

ggplot(data = palmetto, aes(x = species_name, y = height)) +
  geom_boxplot()

```


## Binary Logistic Regression

```{r}
palmetto_blr <- glm(species_name ~ height + length + width + green_lvs, # run binomial regression
                    data = palmetto,
                    family = "binomial")

palmetto_summary <- broom::tidy(palmetto_blr) # make table of coefficients etc

palmetto_summary
```



## Model Success Assessment

```{r}
palmetto_fitted <- palmetto_blr %>% # use blr results
  broom::augment(type.predict = "response") %>% # make a table
  mutate(classified = case_when( # classify species based on results of blm
    .fitted < 0.5 ~ "Sabal etonia",
    .fitted >= 0.5 ~ "Serenoa repens"
  ),
  correct =case_when( # identify where species is correctly classified
    species_name == classified ~ "Yes",
    species_name != classified ~ "No"
  ))

summary_fit <- palmetto_fitted %>% # make summary graph
  count(species_name, correct) %>% # count correct/incorrect classification
  pivot_wider(names_from = correct, # switch organization
              values_from = n) %>% # with counts as values
  mutate(percent_correct = round(Yes/(No + Yes) * 100, 2) # calculate % correct
  )



```



## Citation

Data source: Abrahamson, W.G. 2019. Survival, growth and biomass estimates of two dominant palmetto species of south-central Florida from 1981 - 2017, ongoing at 5-year intervals ver 1. Environmental Data Initiative. https://doi.org/10.6073/pasta/f2f96ec76fbbd4b9db431c79a770c4d5